!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("claygl")):"function"==typeof define&&define.amd?define(["claygl"],t):e.ClayAdvancedRenderer=t(e.clay)}(this,function(e){"use strict";function t(e,t){for(var r=0,n=1/t,o=e;o>0;)r+=n*(o%t),o=Math.floor(o/t),n/=t;return r}function r(t){for(var r=new Uint8Array(t*t*4),n=0,o=new e.Vector3,i=0;i<t;i++)for(var a=0;a<t;a++)o.set(2*Math.random()-1,2*Math.random()-1,0).normalize(),r[n++]=255*(.5*o.x+.5),r[n++]=255*(.5*o.y+.5),r[n++]=0,r[n++]=255;return r}function n(t){return new e.Texture2D({pixels:r(t),wrapS:e.Texture.REPEAT,wrapT:e.Texture.REPEAT,width:t,height:t})}function o(e,r,n){var o=new Float32Array(3*e);r=r||0;for(var i=0;i<e;i++){var a=t(i+r,2)*(n?1:2)*Math.PI,s=t(i+r,3)*Math.PI,u=Math.random(),c=Math.cos(a)*Math.sin(s)*u,l=Math.cos(s)*u,f=Math.sin(a)*Math.sin(s)*u;o[3*i]=c,o[3*i+1]=l,o[3*i+2]=f}return o}function i(t){t=t||{},this._ssaoPass=new p({fragment:e.Shader.source("ecgl.ssao.estimate")}),this._blurPass=new p({fragment:e.Shader.source("ecgl.ssao.blur")}),this._framebuffer=new e.FrameBuffer,this._ssaoTexture=new e.Texture2D,this._blurTexture=new e.Texture2D,this._depthTex=t.depthTexture,this._normalTex=t.normalTexture,this.setNoiseSize(4),this.setKernelSize(t.kernelSize||12),null!=t.radius&&this.setParameter("radius",t.radius),null!=t.power&&this.setParameter("power",t.power),this._normalTex||(this._ssaoPass.material.disableTexture("normalTex"),this._blurPass.material.disableTexture("normalTex")),this._depthTex||this._blurPass.material.disableTexture("depthTex"),this._blurPass.material.setUniform("normalTex",this._normalTex),this._blurPass.material.setUniform("depthTex",this._depthTex)}function a(t){t=t||{},this._ssrPass=new h({fragment:e.Shader.source("ecgl.ssr.main"),clearColor:[0,0,0,0]}),this._blurPass1=new h({fragment:e.Shader.source("ecgl.ssr.blur"),clearColor:[0,0,0,0]}),this._blurPass2=new h({fragment:e.Shader.source("ecgl.ssr.blur"),clearColor:[0,0,0,0]}),this._blendPass=new h({fragment:e.Shader.source("clay.compositor.blend")}),this._blendPass.material.disableTexturesAll(),this._blendPass.material.enableTexture(["texture1","texture2"]),this._ssrPass.setUniform("gBufferTexture1",t.normalTexture),this._ssrPass.setUniform("gBufferTexture2",t.depthTexture),this._ssrPass.setUniform("gBufferTexture3",t.albedoTexture),this._blurPass1.setUniform("gBufferTexture1",t.normalTexture),this._blurPass1.setUniform("gBufferTexture2",t.depthTexture),this._blurPass2.setUniform("gBufferTexture1",t.normalTexture),this._blurPass2.setUniform("gBufferTexture2",t.depthTexture),this._blurPass2.material.define("fragment","VERTICAL"),this._blurPass2.material.define("fragment","BLEND"),this._ssrTexture=new e.Texture2D({type:e.Texture.HALF_FLOAT}),this._texture2=new e.Texture2D({type:e.Texture.HALF_FLOAT}),this._texture3=new e.Texture2D({type:e.Texture.HALF_FLOAT}),this._prevTexture=new e.Texture2D({type:e.Texture.HALF_FLOAT}),this._currentTexture=new e.Texture2D({type:e.Texture.HALF_FLOAT}),this._frameBuffer=new e.FrameBuffer({depthBuffer:!1}),this._normalDistribution=null,this._totalSamples=256,this._samplePerFrame=4,this._ssrPass.material.define("fragment","SAMPLE_PER_FRAME",this._samplePerFrame),this._ssrPass.material.define("fragment","TOTAL_SAMPLES",this._totalSamples),this._downScale=1}function s(){this._sourceTexture=new e.Texture2D({type:e.Texture.HALF_FLOAT}),this._depthTexture=new e.Texture2D({format:e.Texture.DEPTH_COMPONENT,type:e.Texture.UNSIGNED_INT}),this._framebuffer=new e.FrameBuffer,this._framebuffer.attach(this._sourceTexture),this._framebuffer.attach(this._depthTexture,e.FrameBuffer.DEPTH_ATTACHMENT),this._gBufferPass=new x({renderTransparent:!0,enableTargetTexture3:!1}),this._compositor=e.createCompositor(m);var t=this._compositor.getNodeByName("source");t.texture=this._sourceTexture;var r=this._compositor.getNodeByName("coc");this._sourceNode=t,this._cocNode=r,this._compositeNode=this._compositor.getNodeByName("composite"),this._fxaaNode=this._compositor.getNodeByName("FXAA"),this._dofBlurNodes=["dof_far_blur","dof_near_blur","dof_coc_blur"].map(function(e){return this._compositor.getNodeByName(e)},this),this._dofBlurKernel=null,this._dofBlurKernelSize=new Float32Array(0),this._finalNodesChain=v.map(function(e){return this._compositor.getNodeByName(e)},this);var n={normalTexture:this._gBufferPass.getTargetTexture1(),depthTexture:this._gBufferPass.getTargetTexture2(),albedoTexture:this._gBufferPass.getTargetTexture3()};this._ssaoPass=new i(n),this._ssrPass=new a(n)}function u(){for(var r=[],n=0;n<30;n++)r.push([t(n,2),t(n,3)]);this._haltonSequence=r,this._frame=0,this._sourceTex=new e.Texture2D,this._sourceFb=new e.FrameBuffer,this._sourceFb.attach(this._sourceTex),this._prevFrameTex=new e.Texture2D,this._outputTex=new e.Texture2D;var o=this._blendPass=new b({fragment:e.Shader.source("clay.compositor.blend")});o.material.disableTexturesAll(),o.material.enableTexture(["texture1","texture2"]),this._blendFb=new e.FrameBuffer({depthBuffer:!1}),this._outputPass=new b({fragment:e.Shader.source("clay.compositor.output"),blendWithPrevious:!0}),this._outputPass.material.define("fragment","OUTPUT_ALPHA"),this._outputPass.material.blend=function(e){e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)}}function c(e,r,n){this.renderer=e,this.scene=r,this.preZ=!1,this._compositor=new s,this._temporalSS=new u,n&&(this._shadowMapPass=new y({lightFrustumBias:20}));for(var o=[],i=0,a=0;a<30;a++){for(var c=[],l=0;l<6;l++)c.push(4*t(i,2)-2),c.push(4*t(i,3)-2),i++;o.push(c)}this._pcfKernels=o,this._enableTemporalSS="auto",r.on("beforerender",function(e,t,r){this.needsTemporalSS()&&this._temporalSS.jitterProjection(e,r)},this)}function l(e,t){return t={exports:{}},e(t,t.exports),t.exports}function f(e,t,r,n){n=P({},n||{},S),this._renderMain=new c(e,t,n.shadow),this._renderMain.setPostEffect(n.postEffect),this._needsRefresh=!1,this._graphicOpts=n,r.on("frame",this._loop,this)}var p=e.compositor.Pass;e.Shader.import("@export ecgl.ssao.estimate\n#define SHADER_NAME SSAO\nuniform sampler2D depthTex;\nuniform sampler2D normalTex;\nuniform sampler2D noiseTex;\nuniform vec2 depthTexSize;\nuniform vec2 noiseTexSize;\nuniform mat4 projection;\nuniform mat4 projectionInv;\nuniform mat4 viewInverseTranspose;\nuniform vec3 kernel[KERNEL_SIZE];\nuniform float radius : 1;\nuniform float power : 1;\nuniform float bias: 0.01;\nuniform float intensity: 1.0;\nvarying vec2 v_Texcoord;\nfloat ssaoEstimator(in vec3 originPos, in vec3 N, in mat3 kernelBasis) {\n float occlusion = 0.0;\n for (int i = 0; i < KERNEL_SIZE; i++) {\n vec3 samplePos = kernel[i];\n#ifdef NORMALTEX_ENABLED\n samplePos = kernelBasis * samplePos;\n#endif\n samplePos = samplePos * radius + originPos;\n vec4 texCoord = projection * vec4(samplePos, 1.0);\n texCoord.xy /= texCoord.w;\n texCoord.xy = texCoord.xy * 0.5 + 0.5;\n vec4 depthTexel = texture2D(depthTex, texCoord.xy);\n float z = depthTexel.r * 2.0 - 1.0;\n#ifdef ALCHEMY\n vec4 projectedPos = vec4(texCoord.xy * 2.0 - 1.0, z, 1.0);\n vec4 p4 = projectionInv * projectedPos;\n p4.xyz /= p4.w;\n vec3 cDir = p4.xyz - originPos;\n float vv = dot(cDir, cDir);\n float vn = dot(cDir, N);\n float radius2 = radius * radius;\n vn = max(vn + p4.z * bias, 0.0);\n float f = max(radius2 - vv, 0.0) / radius2;\n occlusion += f * f * f * max(vn / (0.01 + vv), 0.0);\n#else\n if (projection[3][3] == 0.0) {\n z = projection[3][2] / (z * projection[2][3] - projection[2][2]);\n }\n else {\n z = (z - projection[3][2]) / projection[2][2];\n }\n float factor = step(samplePos.z, z - bias);\n float rangeCheck = smoothstep(0.0, 1.0, radius / abs(originPos.z - z));\n occlusion += rangeCheck * factor;\n#endif\n }\n#ifdef NORMALTEX_ENABLED\n occlusion = 1.0 - occlusion / float(KERNEL_SIZE);\n#else\n occlusion = 1.0 - clamp((occlusion / float(KERNEL_SIZE) - 0.6) * 2.5, 0.0, 1.0);\n#endif\n return pow(occlusion, power);\n}\nvoid main()\n{\n vec4 depthTexel = texture2D(depthTex, v_Texcoord);\n#ifdef NORMALTEX_ENABLED\n vec4 tex = texture2D(normalTex, v_Texcoord);\n if (dot(tex.rgb, tex.rgb) == 0.0) {\n gl_FragColor = vec4(1.0);\n return;\n }\n vec3 N = tex.rgb * 2.0 - 1.0;\n N = (viewInverseTranspose * vec4(N, 0.0)).xyz;\n vec2 noiseTexCoord = depthTexSize / vec2(noiseTexSize) * v_Texcoord;\n vec3 rvec = texture2D(noiseTex, noiseTexCoord).rgb * 2.0 - 1.0;\n vec3 T = normalize(rvec - N * dot(rvec, N));\n vec3 BT = normalize(cross(N, T));\n mat3 kernelBasis = mat3(T, BT, N);\n#else\n if (depthTexel.r > 0.99999) {\n gl_FragColor = vec4(1.0);\n return;\n }\n mat3 kernelBasis;\n#endif\n float z = depthTexel.r * 2.0 - 1.0;\n vec4 projectedPos = vec4(v_Texcoord * 2.0 - 1.0, z, 1.0);\n vec4 p4 = projectionInv * projectedPos;\n vec3 position = p4.xyz / p4.w;\n float ao = ssaoEstimator(position, N, kernelBasis);\n ao = clamp(1.0 - (1.0 - ao) * intensity, 0.0, 1.0);\n gl_FragColor = vec4(vec3(ao), 1.0);\n}\n@end\n@export ecgl.ssao.blur\n#define SHADER_NAME SSAO_BLUR\nuniform sampler2D ssaoTexture;\n#ifdef NORMALTEX_ENABLED\nuniform sampler2D normalTex;\n#endif\nvarying vec2 v_Texcoord;\nuniform vec2 textureSize;\nuniform float blurSize : 1.0;\nuniform int direction: 0.0;\n#ifdef DEPTHTEX_ENABLED\nuniform sampler2D depthTex;\nuniform mat4 projection;\nuniform float depthRange : 0.05;\nfloat getLinearDepth(vec2 coord)\n{\n float depth = texture2D(depthTex, coord).r * 2.0 - 1.0;\n return projection[3][2] / (depth * projection[2][3] - projection[2][2]);\n}\n#endif\nvoid main()\n{\n float kernel[5];\n kernel[0] = 0.122581;\n kernel[1] = 0.233062;\n kernel[2] = 0.288713;\n kernel[3] = 0.233062;\n kernel[4] = 0.122581;\n vec2 off = vec2(0.0);\n if (direction == 0) {\n off[0] = blurSize / textureSize.x;\n }\n else {\n off[1] = blurSize / textureSize.y;\n }\n vec2 coord = v_Texcoord;\n float sum = 0.0;\n float weightAll = 0.0;\n#ifdef NORMALTEX_ENABLED\n vec3 centerNormal = texture2D(normalTex, v_Texcoord).rgb * 2.0 - 1.0;\n#endif\n#if defined(DEPTHTEX_ENABLED)\n float centerDepth = getLinearDepth(v_Texcoord);\n#endif\n for (int i = 0; i < 5; i++) {\n vec2 coord = clamp(v_Texcoord + vec2(float(i) - 2.0) * off, vec2(0.0), vec2(1.0));\n float w = kernel[i];\n#ifdef NORMALTEX_ENABLED\n vec3 normal = texture2D(normalTex, coord).rgb * 2.0 - 1.0;\n w *= clamp(dot(normal, centerNormal), 0.0, 1.0);\n#endif\n#ifdef DEPTHTEX_ENABLED\n float d = getLinearDepth(coord);\n w *= (1.0 - smoothstep(abs(centerDepth - d) / depthRange, 0.0, 1.0));\n#endif\n weightAll += w;\n sum += texture2D(ssaoTexture, coord).r * w;\n }\n gl_FragColor = vec4(vec3(sum / weightAll), 1.0);\n}\n@end\n"),i.prototype.setDepthTexture=function(e){this._depthTex=e},i.prototype.setNormalTexture=function(e){this._normalTex=e,this._ssaoPass.material[e?"enableTexture":"disableTexture"]("normalTex"),this.setKernelSize(this._kernelSize)},i.prototype.update=function(t,r,n){var o=t.getWidth(),i=t.getHeight(),a=this._ssaoPass,s=this._blurPass;a.setUniform("kernel",this._kernels[n%this._kernels.length]),a.setUniform("depthTex",this._depthTex),null!=this._normalTex&&a.setUniform("normalTex",this._normalTex),a.setUniform("depthTexSize",[this._depthTex.width,this._depthTex.height]);var u=new e.Matrix4;e.Matrix4.transpose(u,r.worldTransform),a.setUniform("projection",r.projectionMatrix.array),a.setUniform("projectionInv",r.invProjectionMatrix.array),a.setUniform("viewInverseTranspose",u.array);var c=this._ssaoTexture,l=this._blurTexture;c.width=o,c.height=i,l.width=o,l.height=i,this._framebuffer.attach(c),this._framebuffer.bind(t),t.gl.clearColor(1,1,1,1),t.gl.clear(t.gl.COLOR_BUFFER_BIT),a.render(t),s.setUniform("textureSize",[o,i]),s.setUniform("projection",r.projectionMatrix.array),this._framebuffer.attach(l),s.setUniform("direction",0),s.setUniform("ssaoTexture",c),s.render(t),this._framebuffer.attach(c),s.setUniform("direction",1),s.setUniform("ssaoTexture",l),s.render(t),this._framebuffer.unbind(t);var f=t.clearColor;t.gl.clearColor(f[0],f[1],f[2],f[3])},i.prototype.getTargetTexture=function(){return this._ssaoTexture},i.prototype.setParameter=function(e,t){"noiseTexSize"===e?this.setNoiseSize(t):"kernelSize"===e?this.setKernelSize(t):"intensity"===e?this._ssaoPass.material.set("intensity",t):this._ssaoPass.setUniform(e,t)},i.prototype.setKernelSize=function(e){this._kernelSize=e,this._ssaoPass.material.define("fragment","KERNEL_SIZE",e),this._kernels=this._kernels||[];for(var t=0;t<30;t++)this._kernels[t]=o(e,t*e,!!this._normalTex)},i.prototype.setNoiseSize=function(e){var t=this._ssaoPass.getUniform("noiseTex");t?(t.data=r(e),t.width=t.height=e,t.dirty()):(t=n(e),this._ssaoPass.setUniform("noiseTex",n(e))),this._ssaoPass.setUniform("noiseTexSize",[e,e])},i.prototype.dispose=function(e){this._blurTexture.dispose(e),this._ssaoTexture.dispose(e)},i.prototype.isFinished=function(e){return e>30};var h=e.compositor.Pass,d=e.util.cubemap;e.Shader.import("@export ecgl.ssr.main\n#define SHADER_NAME SSR\n#define MAX_ITERATION 20;\n#define SAMPLE_PER_FRAME 5;\n#define TOTAL_SAMPLES 128;\nuniform sampler2D sourceTexture;\nuniform sampler2D gBufferTexture1;\nuniform sampler2D gBufferTexture2;\nuniform sampler2D gBufferTexture3;\nuniform samplerCube specularCubemap;\nuniform sampler2D brdfLookup;\nuniform float specularIntensity: 1;\nuniform mat4 projection;\nuniform mat4 projectionInv;\nuniform mat4 toViewSpace;\nuniform mat4 toWorldSpace;\nuniform float maxRayDistance: 200;\nuniform float pixelStride: 16;\nuniform float pixelStrideZCutoff: 50;\nuniform float screenEdgeFadeStart: 0.9;\nuniform float eyeFadeStart : 0.2;uniform float eyeFadeEnd: 0.8;\nuniform float minGlossiness: 0.2;uniform float zThicknessThreshold: 1;\nuniform float nearZ;\nuniform vec2 viewportSize : VIEWPORT_SIZE;\nuniform float jitterOffset: 0;\nvarying vec2 v_Texcoord;\n#ifdef DEPTH_DECODE\n@import clay.util.decode_float\n#endif\n#ifdef PHYSICALLY_CORRECT\nuniform sampler2D normalDistribution;\nuniform float sampleOffset: 0;\nuniform vec2 normalDistributionSize;\nvec3 transformNormal(vec3 H, vec3 N) {\n vec3 upVector = N.y > 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);\n vec3 tangentX = normalize(cross(N, upVector));\n vec3 tangentZ = cross(N, tangentX);\n return normalize(tangentX * H.x + N * H.y + tangentZ * H.z);\n}\nvec3 importanceSampleNormalGGX(float i, float roughness, vec3 N) {\n float p = fract((i + sampleOffset) / float(TOTAL_SAMPLES));\n vec3 H = texture2D(normalDistribution,vec2(roughness, p)).rgb;\n return transformNormal(H, N);\n}\nfloat G_Smith(float g, float ndv, float ndl) {\n float roughness = 1.0 - g;\n float k = roughness * roughness / 2.0;\n float G1V = ndv / (ndv * (1.0 - k) + k);\n float G1L = ndl / (ndl * (1.0 - k) + k);\n return G1L * G1V;\n}\nvec3 F_Schlick(float ndv, vec3 spec) {\n return spec + (1.0 - spec) * pow(1.0 - ndv, 5.0);\n}\n#endif\nfloat fetchDepth(sampler2D depthTexture, vec2 uv)\n{\n vec4 depthTexel = texture2D(depthTexture, uv);\n return depthTexel.r * 2.0 - 1.0;\n}\nfloat linearDepth(float depth)\n{\n if (projection[3][3] == 0.0) {\n return projection[3][2] / (depth * projection[2][3] - projection[2][2]);\n }\n else {\n return (depth - projection[3][2]) / projection[2][2];\n }\n}\nbool rayIntersectDepth(float rayZNear, float rayZFar, vec2 hitPixel)\n{\n if (rayZFar > rayZNear)\n {\n float t = rayZFar; rayZFar = rayZNear; rayZNear = t;\n }\n float cameraZ = linearDepth(fetchDepth(gBufferTexture2, hitPixel));\n return rayZFar <= cameraZ && rayZNear >= cameraZ - zThicknessThreshold;\n}\nbool traceScreenSpaceRay(\n vec3 rayOrigin, vec3 rayDir, float jitter,\n out vec2 hitPixel, out vec3 hitPoint, out float iterationCount\n)\n{\n float rayLength = ((rayOrigin.z + rayDir.z * maxRayDistance) > -nearZ)\n ? (-nearZ - rayOrigin.z) / rayDir.z : maxRayDistance;\n vec3 rayEnd = rayOrigin + rayDir * rayLength;\n vec4 H0 = projection * vec4(rayOrigin, 1.0);\n vec4 H1 = projection * vec4(rayEnd, 1.0);\n float k0 = 1.0 / H0.w, k1 = 1.0 / H1.w;\n vec3 Q0 = rayOrigin * k0, Q1 = rayEnd * k1;\n vec2 P0 = (H0.xy * k0 * 0.5 + 0.5) * viewportSize;\n vec2 P1 = (H1.xy * k1 * 0.5 + 0.5) * viewportSize;\n P1 += dot(P1 - P0, P1 - P0) < 0.0001 ? 0.01 : 0.0;\n vec2 delta = P1 - P0;\n bool permute = false;\n if (abs(delta.x) < abs(delta.y)) {\n permute = true;\n delta = delta.yx;\n P0 = P0.yx;\n P1 = P1.yx;\n }\n float stepDir = sign(delta.x);\n float invdx = stepDir / delta.x;\n vec3 dQ = (Q1 - Q0) * invdx;\n float dk = (k1 - k0) * invdx;\n vec2 dP = vec2(stepDir, delta.y * invdx);\n float strideScaler = 1.0 - min(1.0, -rayOrigin.z / pixelStrideZCutoff);\n float pixStride = 1.0 + strideScaler * pixelStride;\n dP *= pixStride; dQ *= pixStride; dk *= pixStride;\n vec4 pqk = vec4(P0, Q0.z, k0);\n vec4 dPQK = vec4(dP, dQ.z, dk);\n pqk += dPQK * jitter;\n float rayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);\n float rayZNear;\n bool intersect = false;\n vec2 texelSize = 1.0 / viewportSize;\n iterationCount = 0.0;\n for (int i = 0; i < MAX_ITERATION; i++)\n {\n pqk += dPQK;\n rayZNear = rayZFar;\n rayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);\n hitPixel = permute ? pqk.yx : pqk.xy;\n hitPixel *= texelSize;\n intersect = rayIntersectDepth(rayZNear, rayZFar, hitPixel);\n iterationCount += 1.0;\n dPQK *= 1.2;\n if (intersect) {\n break;\n }\n }\n Q0.xy += dQ.xy * iterationCount;\n Q0.z = pqk.z;\n hitPoint = Q0 / pqk.w;\n return intersect;\n}\nfloat calculateAlpha(\n float iterationCount, float reflectivity,\n vec2 hitPixel, vec3 hitPoint, float dist, vec3 rayDir\n)\n{\n float alpha = clamp(reflectivity, 0.0, 1.0);\n alpha *= 1.0 - (iterationCount / float(MAX_ITERATION));\n vec2 hitPixelNDC = hitPixel * 2.0 - 1.0;\n float maxDimension = min(1.0, max(abs(hitPixelNDC.x), abs(hitPixelNDC.y)));\n alpha *= 1.0 - max(0.0, maxDimension - screenEdgeFadeStart) / (1.0 - screenEdgeFadeStart);\n float _eyeFadeStart = eyeFadeStart;\n float _eyeFadeEnd = eyeFadeEnd;\n if (_eyeFadeStart > _eyeFadeEnd) {\n float tmp = _eyeFadeEnd;\n _eyeFadeEnd = _eyeFadeStart;\n _eyeFadeStart = tmp;\n }\n float eyeDir = clamp(rayDir.z, _eyeFadeStart, _eyeFadeEnd);\n alpha *= 1.0 - (eyeDir - _eyeFadeStart) / (_eyeFadeEnd - _eyeFadeStart);\n alpha *= 1.0 - clamp(dist / maxRayDistance, 0.0, 1.0);\n return alpha;\n}\n@import clay.util.rand\n@import clay.util.rgbm\nvoid main()\n{\n vec4 normalAndGloss = texture2D(gBufferTexture1, v_Texcoord);\n if (dot(normalAndGloss.rgb, vec3(1.0)) == 0.0) {\n discard;\n }\n float g = normalAndGloss.a;\n#if !defined(PHYSICALLY_CORRECT)\n if (g <= minGlossiness) {\n discard;\n }\n#endif\n float reflectivity = (g - minGlossiness) / (1.0 - minGlossiness);\n vec3 N = normalize(normalAndGloss.rgb * 2.0 - 1.0);\n N = normalize((toViewSpace * vec4(N, 0.0)).xyz);\n vec4 projectedPos = vec4(v_Texcoord * 2.0 - 1.0, fetchDepth(gBufferTexture2, v_Texcoord), 1.0);\n vec4 pos = projectionInv * projectedPos;\n vec3 rayOrigin = pos.xyz / pos.w;\n vec3 V = -normalize(rayOrigin);\n float ndv = clamp(dot(N, V), 0.0, 1.0);\n float iterationCount;\n float jitter = rand(fract(v_Texcoord + jitterOffset));\n vec4 albedoMetalness = texture2D(gBufferTexture3, v_Texcoord);\n vec3 albedo = albedoMetalness.rgb;\n float m = albedoMetalness.a;\n vec3 diffuseColor = albedo * (1.0 - m);\n vec3 spec = mix(vec3(0.04), albedo, m);\n#ifdef PHYSICALLY_CORRECT\n vec4 color = vec4(vec3(0.0), 1.0);\n float jitter2 = rand(fract(v_Texcoord)) * float(TOTAL_SAMPLES);\n for (int i = 0; i < SAMPLE_PER_FRAME; i++) {\n vec3 H = importanceSampleNormalGGX(float(i) + jitter2, 1.0 - g, N);\n vec3 rayDir = normalize(reflect(-V, H));\n#else\n vec3 rayDir = normalize(reflect(-V, N));\n#endif\n vec2 hitPixel;\n vec3 hitPoint;\n bool intersect = traceScreenSpaceRay(rayOrigin, rayDir, jitter, hitPixel, hitPoint, iterationCount);\n float dist = distance(rayOrigin, hitPoint);\n vec3 hitNormal = texture2D(gBufferTexture1, hitPixel).rgb * 2.0 - 1.0;\n hitNormal = normalize((toViewSpace * vec4(hitNormal, 0.0)).xyz);\n#ifdef PHYSICALLY_CORRECT\n float ndl = clamp(dot(N, rayDir), 0.0, 1.0);\n float vdh = clamp(dot(V, H), 0.0, 1.0);\n float ndh = clamp(dot(N, H), 0.0, 1.0);\n vec3 litTexel = vec3(0.0);\n if (dot(hitNormal, rayDir) < 0.0 && intersect) {\n litTexel = texture2D(sourceTexture, hitPixel).rgb;\n litTexel *= pow(clamp(1.0 - dist / 200.0, 0.0, 1.0), 3.0);\n }\n else {\n#ifdef SPECULARCUBEMAP_ENABLED\n vec3 rayDirW = normalize(toWorldSpace * vec4(rayDir, 0.0)).rgb;\n litTexel = RGBMDecode(textureCubeLodEXT(specularCubemap, rayDirW, 0.0), 8.12).rgb * specularIntensity;\n#endif\n }\n color.rgb += ndl * litTexel * (\n F_Schlick(ndl, spec) * G_Smith(g, ndv, ndl) * vdh / (ndh * ndv + 0.001)\n );\n }\n color.rgb /= float(SAMPLE_PER_FRAME);\n#else\n#if !defined(SPECULARCUBEMAP_ENABLED)\n if (dot(hitNormal, rayDir) >= 0.0) {\n discard;\n }\n if (!intersect) {\n discard;\n }\n#endif\n float alpha = clamp(calculateAlpha(iterationCount, reflectivity, hitPixel, hitPoint, dist, rayDir), 0.0, 1.0);\n vec4 color = texture2D(sourceTexture, hitPixel);\n color.rgb *= alpha;\n#ifdef SPECULARCUBEMAP_ENABLED\n vec3 rayDirW = normalize(toWorldSpace * vec4(rayDir, 0.0)).rgb;\n alpha = alpha * (intersect ? 1.0 : 0.0);\n float bias = (1.0 - g) * 5.0;\n vec2 brdfParam2 = texture2D(brdfLookup, vec2(1.0 - g, ndv)).xy;\n color.rgb += (1.0 - alpha)\n * RGBMDecode(textureCubeLodEXT(specularCubemap, rayDirW, bias), 8.12).rgb\n * (spec * brdfParam2.x + brdfParam2.y)\n * specularIntensity;\n#endif\n#endif\n gl_FragColor = encodeHDR(color);\n}\n@end\n@export ecgl.ssr.blur\nuniform sampler2D texture;\nuniform sampler2D gBufferTexture1;\nuniform sampler2D gBufferTexture2;\nuniform mat4 projection;\nuniform float depthRange : 0.05;\nvarying vec2 v_Texcoord;\nuniform vec2 textureSize;\nuniform float blurSize : 1.0;\n#ifdef BLEND\n #ifdef SSAOTEX_ENABLED\nuniform sampler2D ssaoTex;\n #endif\nuniform sampler2D sourceTexture;\n#endif\nfloat getLinearDepth(vec2 coord)\n{\n float depth = texture2D(gBufferTexture2, coord).r * 2.0 - 1.0;\n return projection[3][2] / (depth * projection[2][3] - projection[2][2]);\n}\n@import clay.util.rgbm\nvoid main()\n{\n @import clay.compositor.kernel.gaussian_9\n vec4 centerNTexel = texture2D(gBufferTexture1, v_Texcoord);\n float g = centerNTexel.a;\n float maxBlurSize = clamp(1.0 - g, 0.0, 1.0) * blurSize;\n#ifdef VERTICAL\n vec2 off = vec2(0.0, maxBlurSize / textureSize.y);\n#else\n vec2 off = vec2(maxBlurSize / textureSize.x, 0.0);\n#endif\n vec2 coord = v_Texcoord;\n vec4 sum = vec4(0.0);\n float weightAll = 0.0;\n vec3 cN = centerNTexel.rgb * 2.0 - 1.0;\n float cD = getLinearDepth(v_Texcoord);\n for (int i = 0; i < 9; i++) {\n vec2 coord = clamp((float(i) - 4.0) * off + v_Texcoord, vec2(0.0), vec2(1.0));\n float w = gaussianKernel[i]\n * clamp(dot(cN, texture2D(gBufferTexture1, coord).rgb * 2.0 - 1.0), 0.0, 1.0);\n float d = getLinearDepth(coord);\n w *= (1.0 - smoothstep(abs(cD - d) / depthRange, 0.0, 1.0));\n weightAll += w;\n sum += decodeHDR(texture2D(texture, coord)) * w;\n }\n#ifdef BLEND\n float aoFactor = 1.0;\n #ifdef SSAOTEX_ENABLED\n aoFactor = texture2D(ssaoTex, v_Texcoord).r;\n #endif\n gl_FragColor = encodeHDR(\n sum / weightAll * aoFactor + decodeHDR(texture2D(sourceTexture, v_Texcoord))\n );\n#else\n gl_FragColor = encodeHDR(sum / weightAll);\n#endif\n}\n@end"),a.prototype.setAmbientCubemap=function(e,t,r){this._ssrPass.material.set("specularCubemap",e),this._ssrPass.material.set("brdfLookup",t),this._ssrPass.material.set("specularIntensity",r);var n=e&&r;this._ssrPass.material[n?"enableTexture":"disableTexture"]("specularCubemap")},a.prototype.update=function(t,r,n,o){var i=t.getWidth(),a=t.getHeight(),s=this._ssrTexture,u=this._texture2,c=this._texture3;s.width=this._prevTexture.width=this._currentTexture.width=i/this._downScale,s.height=this._prevTexture.height=this._currentTexture.height=a/this._downScale,u.width=c.width=i,u.height=c.height=a;var l=this._frameBuffer,f=this._ssrPass,p=this._blurPass1,h=this._blurPass2,d=this._blendPass,_=new e.Matrix4,m=new e.Matrix4;e.Matrix4.transpose(_,r.worldTransform),e.Matrix4.transpose(m,r.viewMatrix),f.setUniform("sourceTexture",n),f.setUniform("projection",r.projectionMatrix.array),f.setUniform("projectionInv",r.invProjectionMatrix.array),f.setUniform("toViewSpace",_.array),f.setUniform("toWorldSpace",m.array),f.setUniform("nearZ",r.near);var x=o/this._totalSamples*this._samplePerFrame;if(f.setUniform("jitterOffset",x),f.setUniform("sampleOffset",o*this._samplePerFrame),p.setUniform("textureSize",[s.width,s.height]),h.setUniform("textureSize",[i,a]),h.setUniform("sourceTexture",n),p.setUniform("projection",r.projectionMatrix.array),h.setUniform("projection",r.projectionMatrix.array),l.attach(s),l.bind(t),f.render(t),this._physicallyCorrect&&(l.attach(this._currentTexture),d.setUniform("texture1",this._prevTexture),d.setUniform("texture2",s),d.material.set({weight1:o>=1?.95:0,weight2:o>=1?.05:1}),d.render(t)),l.attach(u),p.setUniform("texture",this._physicallyCorrect?this._currentTexture:s),p.render(t),l.attach(c),h.setUniform("texture",u),h.render(t),l.unbind(t),this._physicallyCorrect){var g=this._prevTexture;this._prevTexture=this._currentTexture,this._currentTexture=g}},a.prototype.getTargetTexture=function(){return this._texture3},a.prototype.setParameter=function(e,t){"maxIteration"===e?this._ssrPass.material.define("fragment","MAX_ITERATION",t):this._ssrPass.setUniform(e,t)},a.prototype.setPhysicallyCorrect=function(e){e?(this._normalDistribution||(this._normalDistribution=d.generateNormalDistribution(64,this._totalSamples)),this._ssrPass.material.define("fragment","PHYSICALLY_CORRECT"),this._ssrPass.material.set("normalDistribution",this._normalDistribution),this._ssrPass.material.set("normalDistributionSize",[64,this._totalSamples])):this._ssrPass.material.undefine("fragment","PHYSICALLY_CORRECT"),this._physicallyCorrect=e},a.prototype.setSSAOTexture=function(e){var t=this._blurPass2;e?(t.material.enableTexture("ssaoTex"),t.material.set("ssaoTex",e)):t.material.disableTexture("ssaoTex")},a.prototype.isFinished=function(e){return!this._physicallyCorrect||e>this._totalSamples/this._samplePerFrame},a.prototype.dispose=function(e){this._ssrTexture.dispose(e),this._texture2.dispose(e),this._texture3.dispose(e),this._prevTexture.dispose(e),this._currentTexture.dispose(e),this._frameBuffer.dispose(e)};var _=[0,0,-.321585265978,-.154972575841,.458126042375,.188473391593,.842080129861,.527766490688,.147304551086,-.659453822776,-.331943915203,-.940619700594,.0479226680259,.54812163202,.701581552186,-.709825561388,-.295436780218,.940589268233,-.901489676764,.237713156085,.973570876096,-.109899459384,-.866792314779,-.451805525005,.330975007087,.800048655954,-.344275183665,.381779221166,-.386139432542,-.437418421534,-.576478634965,-.0148463392551,.385798197415,-.262426961053,-.666302061145,.682427250835,-.628010632582,-.732836215494,.10163141741,-.987658134403,.711995289051,-.320024291314,.0296005138058,.950296523438,.0130612307608,-.351024443122,-.879596633704,-.10478487883,.435712737232,.504254490347,.779203817497,.206477676721,.388264289969,-.896736162545,-.153106280781,-.629203242522,-.245517550697,.657969239148,.126830499058,.26862328493,-.634888119007,-.302301223431,.617074219636,.779817204925],m={type:"compositor",nodes:[{name:"source",type:"texture",outputs:{color:{}}},{name:"source_half",shader:"#source(clay.compositor.downsample)",inputs:{texture:"source"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"}},{name:"bright",shader:"#source(clay.compositor.bright)",inputs:{texture:"source_half"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{threshold:2,scale:4,textureSize:"expr([width * 1.0 / 2, height / 2])"}},{name:"bright_downsample_4",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 2, height / 2] )"}},{name:"bright_downsample_8",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright_downsample_4"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 4, height / 4] )"}},{name:"bright_downsample_16",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright_downsample_8"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 16)",height:"expr(height * 1.0 / 16)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 8, height / 8] )"}},{name:"bright_downsample_32",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright_downsample_16"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 32)",height:"expr(height * 1.0 / 32)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 16, height / 16] )"}},{name:"bright_upsample_16_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_32"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 16)",height:"expr(height * 1.0 / 16)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 32, height / 32] )"}},{name:"bright_upsample_16_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_16_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 16)",height:"expr(height * 1.0 / 16)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 32, height * 1.0 / 32] )"}},{name:"bright_upsample_8_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_16"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 16, height * 1.0 / 16] )"}},{name:"bright_upsample_8_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_8_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 16, height * 1.0 / 16] )"}},{name:"bright_upsample_8_blend",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_8_blur_v",texture2:"bright_upsample_16_blur_v"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"bright_upsample_4_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_8"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 8, height * 1.0 / 8] )"}},{name:"bright_upsample_4_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_4_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 8, height * 1.0 / 8] )"}},{name:"bright_upsample_4_blend",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_4_blur_v",texture2:"bright_upsample_8_blend"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"bright_upsample_2_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_4"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 4, height * 1.0 / 4] )"}},{name:"bright_upsample_2_blur_v",
shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_2_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 4, height * 1.0 / 4] )"}},{name:"bright_upsample_2_blend",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_2_blur_v",texture2:"bright_upsample_4_blend"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"bright_upsample_full_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 2, height * 1.0 / 2] )"}},{name:"bright_upsample_full_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_full_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 2, height * 1.0 / 2] )"}},{name:"bloom_composite",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_full_blur_v",texture2:"bright_upsample_2_blend"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"coc",shader:"#source(ecgl.dof.coc)",outputs:{color:{parameters:{minFilter:"NEAREST",magFilter:"NEAREST",width:"expr(width * 1.0)",height:"expr(height * 1.0)"}}},parameters:{focalDist:50,focalRange:30}},{name:"dof_far_blur",shader:"#source(ecgl.dof.diskBlur)",inputs:{texture:"source",coc:"coc"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"}},{name:"dof_near_blur",shader:"#source(ecgl.dof.diskBlur)",inputs:{texture:"source",coc:"coc"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"},defines:{BLUR_NEARFIELD:null}},{name:"dof_coc_blur",shader:"#source(ecgl.dof.diskBlur)",inputs:{texture:"coc"},outputs:{color:{parameters:{minFilter:"NEAREST",magFilter:"NEAREST",width:"expr(width * 1.0)",height:"expr(height * 1.0)"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"},defines:{BLUR_COC:null}},{name:"dof_composite",shader:"#source(ecgl.dof.composite)",inputs:{original:"source",blurred:"dof_far_blur",nearfield:"dof_near_blur",coc:"coc",nearcoc:"dof_coc_blur"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}}},{name:"composite",shader:"#source(clay.compositor.hdr.composite)",inputs:{texture:"source",bloom:"bloom_composite"},defines:{}},{name:"FXAA",shader:"#source(clay.compositor.fxaa)",inputs:{texture:"composite"}}]},x=e.deferred.GBuffer;e.Shader.import("@export ecgl.dof.coc\nuniform sampler2D depth;\nuniform float zNear: 0.1;\nuniform float zFar: 2000;\nuniform float focalDistance: 3;\nuniform float focalRange: 1;\nuniform float focalLength: 30;\nuniform float fstop: 2.8;\nvarying vec2 v_Texcoord;\n@import clay.util.encode_float\nvoid main()\n{\n float z = texture2D(depth, v_Texcoord).r * 2.0 - 1.0;\n float dist = 2.0 * zNear * zFar / (zFar + zNear - z * (zFar - zNear));\n float aperture = focalLength / fstop;\n float coc;\n float uppper = focalDistance + focalRange;\n float lower = focalDistance - focalRange;\n if (dist <= uppper && dist >= lower) {\n coc = 0.5;\n }\n else {\n float focalAdjusted = dist > uppper ? uppper : lower;\n coc = abs(aperture * (focalLength * (dist - focalAdjusted)) / (dist * (focalAdjusted - focalLength)));\n coc = clamp(coc, 0.0, 2.0) / 2.00001;\n if (dist < lower) {\n coc = -coc;\n }\n coc = coc * 0.5 + 0.5;\n }\n gl_FragColor = encodeFloat(coc);\n}\n@end\n@export ecgl.dof.composite\n#define DEBUG 0\nuniform sampler2D original;\nuniform sampler2D blurred;\nuniform sampler2D nearfield;\nuniform sampler2D coc;\nuniform sampler2D nearcoc;\nvarying vec2 v_Texcoord;\n@import clay.util.rgbm\n@import clay.util.float\nvoid main()\n{\n vec4 blurredColor = decodeHDR(texture2D(blurred, v_Texcoord));\n vec4 originalColor = decodeHDR(texture2D(original, v_Texcoord));\n float fCoc = decodeFloat(texture2D(coc, v_Texcoord));\n fCoc = abs(fCoc * 2.0 - 1.0);\n float weight = smoothstep(0.0, 1.0, fCoc);\n#ifdef NEARFIELD_ENABLED\n vec4 nearfieldColor = decodeHDR(texture2D(nearfield, v_Texcoord));\n float fNearCoc = decodeFloat(texture2D(nearcoc, v_Texcoord));\n fNearCoc = abs(fNearCoc * 2.0 - 1.0);\n gl_FragColor = encodeHDR(\n mix(\n nearfieldColor, mix(originalColor, blurredColor, weight),\n pow(1.0 - fNearCoc, 4.0)\n )\n );\n#else\n gl_FragColor = encodeHDR(mix(originalColor, blurredColor, weight));\n#endif\n}\n@end\n@export ecgl.dof.diskBlur\n#define POISSON_KERNEL_SIZE 16;\nuniform sampler2D texture;\nuniform sampler2D coc;\nvarying vec2 v_Texcoord;\nuniform float blurRadius : 10.0;\nuniform vec2 textureSize : [512.0, 512.0];\nuniform vec2 poissonKernel[POISSON_KERNEL_SIZE];\nuniform float percent;\nfloat nrand(const in vec2 n) {\n return fract(sin(dot(n.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n@import clay.util.rgbm\n@import clay.util.float\nvoid main()\n{\n vec2 offset = blurRadius / textureSize;\n float rnd = 6.28318 * nrand(v_Texcoord + 0.07 * percent );\n float cosa = cos(rnd);\n float sina = sin(rnd);\n vec4 basis = vec4(cosa, -sina, sina, cosa);\n#if !defined(BLUR_NEARFIELD) && !defined(BLUR_COC)\n offset *= abs(decodeFloat(texture2D(coc, v_Texcoord)) * 2.0 - 1.0);\n#endif\n#ifdef BLUR_COC\n float cocSum = 0.0;\n#else\n vec4 color = vec4(0.0);\n#endif\n float weightSum = 0.0;\n for (int i = 0; i < POISSON_KERNEL_SIZE; i++) {\n vec2 ofs = poissonKernel[i];\n ofs = vec2(dot(ofs, basis.xy), dot(ofs, basis.zw));\n vec2 uv = v_Texcoord + ofs * offset;\n vec4 texel = texture2D(texture, uv);\n float w = 1.0;\n#ifdef BLUR_COC\n float fCoc = decodeFloat(texel) * 2.0 - 1.0;\n cocSum += clamp(fCoc, -1.0, 0.0) * w;\n#else\n texel = decodeHDR(texel);\n #if !defined(BLUR_NEARFIELD)\n float fCoc = decodeFloat(texture2D(coc, uv)) * 2.0 - 1.0;\n w *= abs(fCoc);\n #endif\n color += texel * w;\n#endif\n weightSum += w;\n }\n#ifdef BLUR_COC\n gl_FragColor = encodeFloat(clamp(cocSum / weightSum, -1.0, 0.0) * 0.5 + 0.5);\n#else\n color /= weightSum;\n gl_FragColor = encodeHDR(color);\n#endif\n}\n@end");var g={color:{parameters:{width:function(e){return e.getWidth()},height:function(e){return e.getHeight()}}}},v=["composite","FXAA"];s.prototype.resize=function(e,t,r){r=r||1,e*=r,t*=r;var n=this._sourceTexture,o=this._depthTexture;n.width=e,n.height=t,o.width=e,o.height=t,this._gBufferPass.resize(e,t)},s.prototype._ifRenderNormalPass=function(){return this._enableSSAO||this._enableEdge||this._enableSSR},s.prototype._getPrevNode=function(e){for(var t=v.indexOf(e.name)-1,r=this._finalNodesChain[t];r&&!this._compositor.getNodeByName(r.name);)t-=1,r=this._finalNodesChain[t];return r},s.prototype._getNextNode=function(e){for(var t=v.indexOf(e.name)+1,r=this._finalNodesChain[t];r&&!this._compositor.getNodeByName(r.name);)t+=1,r=this._finalNodesChain[t];return r},s.prototype._addChainNode=function(e){var t=this._getPrevNode(e),r=this._getNextNode(e);t&&(t.outputs=g,e.inputs.texture=t.name,r?(e.outputs=g,r.inputs.texture=e.name):e.outputs=null,this._compositor.addNode(e))},s.prototype._removeChainNode=function(e){var t=this._getPrevNode(e),r=this._getNextNode(e);t&&(r?(t.outputs=g,r.inputs.texture=t.name):t.outputs=null,this._compositor.removeNode(e))},s.prototype.updateGBuffer=function(e,t,r,n){this._ifRenderNormalPass()&&this._gBufferPass.update(e,t,r)},s.prototype.updateSSAO=function(e,t,r,n){this._ssaoPass.update(e,r,n)},s.prototype.enableSSAO=function(){this._enableSSAO=!0},s.prototype.disableSSAO=function(){this._enableSSAO=!1},s.prototype.enableSSR=function(){this._enableSSR=!0,this._gBufferPass.enableTargetTexture3=!0},s.prototype.disableSSR=function(){this._enableSSR=!1,this._gBufferPass.enableTargetTexture3=!1},s.prototype.getSSAOTexture=function(){return this._ssaoPass.getTargetTexture()},s.prototype.getSourceFrameBuffer=function(){return this._framebuffer},s.prototype.getSourceTexture=function(){return this._sourceTexture},s.prototype.disableFXAA=function(){this._removeChainNode(this._fxaaNode)},s.prototype.enableFXAA=function(){this._addChainNode(this._fxaaNode)},s.prototype.enableBloom=function(){this._compositeNode.inputs.bloom="bloom_composite",this._compositor.dirty()},s.prototype.disableBloom=function(){this._compositeNode.inputs.bloom=null,this._compositor.dirty()},s.prototype.enableDOF=function(){this._compositeNode.inputs.texture="dof_composite",this._compositor.dirty()},s.prototype.disableDOF=function(){this._compositeNode.inputs.texture="source",this._compositor.dirty()},s.prototype.enableColorCorrection=function(){this._compositeNode.define("COLOR_CORRECTION"),this._enableColorCorrection=!0},s.prototype.disableColorCorrection=function(){this._compositeNode.undefine("COLOR_CORRECTION"),this._enableColorCorrection=!1},s.prototype.enableEdge=function(){this._enableEdge=!0},s.prototype.disableEdge=function(){this._enableEdge=!1},s.prototype.setBloomIntensity=function(e){null!=e&&this._compositeNode.setParameter("bloomIntensity",e)},s.prototype.setSSAOParameter=function(e,t){if(null!=t)switch(e){case"quality":var r={low:6,medium:12,high:32,ultra:62}[t]||12;this._ssaoPass.setParameter("kernelSize",r);break;case"radius":this._ssaoPass.setParameter(e,t),this._ssaoPass.setParameter("bias",t/50);break;case"intensity":this._ssaoPass.setParameter(e,t)}},s.prototype.setDOFParameter=function(e,t){if(null!=t)switch(e){case"focalDistance":case"focalRange":case"fstop":this._cocNode.setParameter(e,t);break;case"blurRadius":for(var r=0;r<this._dofBlurNodes.length;r++)this._dofBlurNodes[r].setParameter("blurRadius",t);break;case"quality":var n={low:4,medium:8,high:16,ultra:32}[t]||8;this._dofBlurKernelSize=n;for(var r=0;r<this._dofBlurNodes.length;r++)this._dofBlurNodes[r].define("POISSON_KERNEL_SIZE",n);this._dofBlurKernel=new Float32Array(2*n)}},s.prototype.setSSRParameter=function(e,t){if(null!=t)switch(e){case"quality":var r={low:10,medium:15,high:30,ultra:80}[t]||20,n={low:32,medium:16,high:8,ultra:4}[t]||16;this._ssrPass.setParameter("maxIteration",r),this._ssrPass.setParameter("pixelStride",n);break;case"maxRoughness":this._ssrPass.setParameter("minGlossiness",Math.max(Math.min(1-t,1),0));break;case"physical":this.setPhysicallyCorrectSSR(t);break;default:console.warn("Unkown SSR parameter "+e)}},s.prototype.setPhysicallyCorrectSSR=function(e){this._ssrPass.setPhysicallyCorrect(e)},s.prototype.setEdgeColor=function(e){},s.prototype.setExposure=function(e){null!=e&&this._compositeNode.setParameter("exposure",Math.pow(2,e))},s.prototype.setColorLookupTexture=function(e,t){},s.prototype.setColorCorrection=function(e,t){this._compositeNode.setParameter(e,t)},s.prototype.composite=function(e,t,r,n,o){var i=this._sourceTexture,a=i;if(this._enableSSR){this._ssrPass.update(e,r,i,o),a=this._ssrPass.getTargetTexture(),this._ssrPass.setSSAOTexture(this._enableSSAO?this._ssaoPass.getTargetTexture():null);for(var s=t.getLights(),u=0;u<s.length;u++)s[u].cubemap&&this._ssrPass.setAmbientCubemap(s[u].cubemap,s[u]._brdfLookup,s[u].intensity)}this._sourceNode.texture=a,this._cocNode.setParameter("depth",this._depthTexture);for(var c=this._dofBlurKernel,l=this._dofBlurKernelSize,f=Math.floor(_.length/2/l),p=o%f,u=0;u<2*l;u++)c[u]=_[u+p*l*2];for(var u=0;u<this._dofBlurNodes.length;u++)this._dofBlurNodes[u].setParameter("percent",o/30),this._dofBlurNodes[u].setParameter("poissonKernel",c);this._cocNode.setParameter("zNear",r.near),this._cocNode.setParameter("zFar",r.far),this._compositor.render(e,n)},s.prototype.isSSRFinished=function(e){return!this._ssrPass||this._ssrPass.isFinished(e)},s.prototype.isSSAOFinished=function(e){return!this._ssaoPass||this._ssaoPass.isFinished(e)},s.prototype.isSSREnabled=function(){return this._enableSSR},s.prototype.dispose=function(e){this._sourceTexture.dispose(e),this._depthTexture.dispose(e),this._framebuffer.dispose(e),this._compositor.dispose(e),this._gBufferPass.dispose(e),this._ssaoPass.dispose(e)};var b=e.compositor.Pass;u.prototype={constructor:u,jitterProjection:function(t,r){var n=t.viewport,o=n.devicePixelRatio||t.getDevicePixelRatio(),i=n.width*o,a=n.height*o,s=this._haltonSequence[this._frame%this._haltonSequence.length],u=new e.Matrix4;u.array[12]=(2*s[0]-1)/i,u.array[13]=(2*s[1]-1)/a,e.Matrix4.mul(r.projectionMatrix,u,r.projectionMatrix),e.Matrix4.invert(r.invProjectionMatrix,r.projectionMatrix)},resetFrame:function(){this._frame=0},getFrame:function(){return this._frame},getSourceFrameBuffer:function(){return this._sourceFb},resize:function(e,t){this._sourceTex.width===e&&this._sourceTex.height===t||(this._prevFrameTex.width=e,this._prevFrameTex.height=t,this._outputTex.width=e,this._outputTex.height=t,this._sourceTex.width=e,this._sourceTex.height=t,this._prevFrameTex.dirty(),this._outputTex.dirty(),this._sourceTex.dirty())},isFinished:function(){return this._frame>=this._haltonSequence.length},render:function(e){var t=this._blendPass;0===this._frame?(t.setUniform("weight1",0),t.setUniform("weight2",1)):(t.setUniform("weight1",.9),t.setUniform("weight2",.1)),t.setUniform("texture1",this._prevFrameTex),t.setUniform("texture2",this._sourceTex),this._blendFb.attach(this._outputTex),this._blendFb.bind(e),t.render(e),this._blendFb.unbind(e),this._outputPass.setUniform("texture",this._outputTex),this._outputPass.render(e);var r=this._prevFrameTex;this._prevFrameTex=this._outputTex,this._outputTex=r,this._frame++},dispose:function(e){this._sourceFb.dispose(e),this._blendFb.dispose(e),this._prevFrameTex.dispose(e),this._outputTex.dispose(e),this._sourceTex.dispose(e),this._outputPass.dispose(e),this._blendPass.dispose(e)}};var y=e.prePass.ShadowMap,T=(e.camera.Perspective,new e.Vector2);c.prototype.castRay=function(e,t,r){var n=this.layer.renderer,o=n.viewport;return n.viewport=this.viewport,n.screenToNDC(e,t,T),this.camera.castRay(T,r),n.viewport=o,r},c.prototype.prepareRender=function(){var e=this.scene,t=e.getMainCamera(),r=this.renderer;t.aspect=r.getViewportAspect(),e.update(),e.updateLights();var n=e.updateRenderList(t);this._updateSRGBOfList(n.opaque),this._updateSRGBOfList(n.transparent),this._frame=0,this._temporalSS.resetFrame();for(var o=e.getLights(),i=0;i<o.length;i++)o[i].cubemap&&(this._compositor&&this._compositor.isSSREnabled()?o[i].invisible=!0:o[i].invisible=!1);this._enablePostEffect&&(this._compositor.resize(r.getWidth(),r.getHeight(),r.getDevicePixelRatio()),this._temporalSS.resize(r.getWidth(),r.getHeight()))},c.prototype.render=function(e){var t=this.scene,r=t.getMainCamera();this._doRender(t,r,e,this._frame),this._frame++},c.prototype.needsAccumulate=function(){return this.needsTemporalSS()||this._needsSortProgressively},c.prototype.needsTemporalSS=function(){var e=this._enableTemporalSS;return"auto"===e&&(e=this._enablePostEffect),e},c.prototype.hasDOF=function(){return this._enableDOF},c.prototype.isAccumulateFinished=function(){var e=this._frame;return!(this.needsTemporalSS()&&!this._temporalSS.isFinished(e)||this._compositor&&!this._compositor.isSSAOFinished(e)||this._compositor&&!this._compositor.isSSRFinished(e)||this._compositor&&e<30)},c.prototype._doRender=function(e,t,r,n){var o=this.renderer;n=n||0,!r&&this._shadowMapPass&&(this._shadowMapPass.kernelPCF=this._pcfKernels[0],this._shadowMapPass.render(o,e,t,!0)),this._updateShadowPCFKernel(e,t,n),o.gl.clearColor(0,0,0,0),this._enablePostEffect&&(this.needsTemporalSS()&&this._temporalSS.jitterProjection(o,t),this._compositor.updateGBuffer(o,e,t,this._temporalSS.getFrame())),this._updateSSAO(o,e,t,this._temporalSS.getFrame());var i;this._enablePostEffect?(i=this._compositor.getSourceFrameBuffer(),i.bind(o),o.gl.clear(o.gl.DEPTH_BUFFER_BIT|o.gl.COLOR_BUFFER_BIT),o.render(e,t,!0,this.preZ),this.afterRenderScene(o,e,t),i.unbind(o),this.needsTemporalSS()&&r?(this._compositor.composite(o,e,t,this._temporalSS.getSourceFrameBuffer(),this._temporalSS.getFrame()),this._temporalSS.render(o)):this._compositor.composite(o,e,t,null,0)):this.needsTemporalSS()&&r?(i=this._temporalSS.getSourceFrameBuffer(),i.bind(o),o.saveClear(),o.clearBit=o.gl.DEPTH_BUFFER_BIT|o.gl.COLOR_BUFFER_BIT,o.render(e,t,!0,this.preZ),this.afterRenderScene(o,e,t),o.restoreClear(),i.unbind(o),this._temporalSS.render(o)):(o.render(e,t,!0,this.preZ),this.afterRenderScene(o,e,t)),this.afterRenderAll(o,e,t)},c.prototype._updateSRGBOfList=function(e){for(var t=this.isLinearSpace(),r=0;r<e.length;r++)e[r].material[t?"define":"undefine"]("fragment","SRGB_DECODE")},c.prototype.afterRenderScene=function(e,t,r){},c.prototype.afterRenderAll=function(e,t,r){},c.prototype._updateSSAO=function(e,t,r,n){function o(e){for(var t=0;t<e.length;t++){var r=e[t];r.material[i?"enableTexture":"disableTexture"]("ssaoMap"),i&&r.material.set("ssaoMap",a.getSSAOTexture())}}var i=this._enableSSAO&&this._enablePostEffect,a=this._compositor;i&&this._compositor.updateSSAO(e,t,r,this._temporalSS.getFrame()),o(t.getRenderList(r).opaque),o(t.getRenderList(r).transparent)},c.prototype._updateShadowPCFKernel=function(e,t,r){function n(e){for(var t=0;t<e.length;t++)e[t].receiveShadow&&(e[t].material.set("pcfKernel",o),e[t].material&&e[t].material.define("fragment","PCF_KERNEL_SIZE",o.length/2))}var o=this._pcfKernels[r%this._pcfKernels.length];n(e.getRenderList(t).opaque),n(e.getRenderList(t).transparent)},c.prototype.dispose=function(){var e=this.renderer;this._compositor.dispose(e),this._temporalSS.dispose(e),this._shadowMapPass&&this._shadowMapPass.dispose(e),e.dispose()},c.prototype.setPostEffect=function(e,t){var r=this._compositor;e=e||{},this._enablePostEffect=!!e.enable;var n=e.bloom||{},o=e.edge||{},i=e.depthOfField||{},a=e.screenSpaceAmbientOcclusion||{},s=e.screenSpaceReflection||{},u=e.FXAA||{},c=e.colorCorrection||{};n.enable?r.enableBloom():r.disableBloom(),i.enable?r.enableDOF():r.disableDOF(),s.enable?r.enableSSR():r.disableSSR(),c.enable?r.enableColorCorrection():r.disableColorCorrection(),o.enable?r.enableEdge():r.disableEdge(),u.enable?r.enableFXAA():r.disableFXAA(),this._enableDOF=i.enable,this._enableSSAO=a.enable,this._enableSSAO?r.enableSSAO():r.disableSSAO(),r.setBloomIntensity(n.intensity),r.setEdgeColor(o.color),r.setColorLookupTexture(c.lookupTexture,t),r.setExposure(c.exposure),["radius","quality","intensity"].forEach(function(e){r.setSSAOParameter(e,a[e])}),["quality","maxRoughness","physical"].forEach(function(e){r.setSSRParameter(e,s[e])}),["quality","focalDistance","focalRange","blurRadius","fstop"].forEach(function(e){r.setDOFParameter(e,i[e])}),["brightness","contrast","saturation"].forEach(function(e){r.setColorCorrection(e,c[e])})},c.prototype.isDOFEnabled=function(){return this._enablePostEffect&&this._enableDOF},c.prototype.setDOFFocusOnPoint=function(e){if(this._enablePostEffect){if(e>this.camera.far||e<this.camera.near)return;return this._compositor.setDOFParameter("focalDistance",e),!0}},c.prototype.setTemporalSuperSampling=function(e){e=e||{},this._enableTemporalSS=e.enable},c.prototype.isLinearSpace=function(){return this._enablePostEffect};var S={shadow:!0,postEffect:{enable:!0,bloom:{enable:!0,intensity:.1},depthOfField:{enable:!1,focalDistance:5,focalRange:1,blurRadius:5,fstop:2.8,quality:"medium"},screenSpaceAmbientOcculusion:{enable:!1,physical:!1,radius:.5,quality:"medium",intensity:1},screenSpaceReflection:{enable:!1,quality:"medium",maxRoughness:.8},colorCorrection:{enable:!0,exposure:0,brightness:0,contrast:1,saturation:1,lookupTexture:""},FXAA:{enable:!1}}},w="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},P=l(function(e,t){function r(e,t){return e.set(t[0],t[1]),e}function n(e,t){return e.add(t),e}function o(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function i(e,t){for(var r=-1,n=e?e.length:0;++r<n&&!1!==t(e[r],r,e););return e}function a(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}function s(e,t,r,n){var o=-1,i=e?e.length:0;for(n&&i&&(r=e[++o]);++o<i;)r=t(r,e[o],o,e);return r}function u(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function c(e,t){return null==e?void 0:e[t]}function l(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function f(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}function p(e,t){return function(r){return e(t(r))}}function h(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}function d(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function _(){this.__data__=er?er(null):{}}function m(e){return this.has(e)&&delete this.__data__[e]}function x(e){var t=this.__data__;if(er){var r=t[e];return r===Ie?void 0:r}return Rt.call(t,e)?t[e]:void 0}function g(e){var t=this.__data__;return er?void 0!==t[e]:Rt.call(t,e)}function v(e,t){return this.__data__[e]=er&&void 0===t?Ie:t,this}function b(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function y(){this.__data__=[]}function T(e){var t=this.__data__,r=H(t,e);return!(r<0)&&(r==t.length-1?t.pop():Kt.call(t,r,1),!0)}function S(e){var t=this.__data__,r=H(t,e);return r<0?void 0:t[r][1]}function P(e){return H(this.__data__,e)>-1}function A(e,t){var r=this.__data__,n=H(r,e);return n<0?r.push([e,t]):r[n][1]=t,this}function F(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function D(){this.__data__={hash:new d,map:new(Wt||b),string:new d}}function E(e){return he(this,e).delete(e)}function O(e){return he(this,e).get(e)}function N(e){return he(this,e).has(e)}function C(e,t){return he(this,e).set(e,t),this}function L(e){this.__data__=new b(e)}function R(){this.__data__=new b}function j(e){return this.__data__.delete(e)}function z(e){return this.__data__.get(e)}function B(e){return this.__data__.has(e)}function M(e,t){var r=this.__data__;if(r instanceof b){var n=r.__data__;if(!Wt||n.length<ke-1)return n.push([e,t]),this;r=this.__data__=new F(n)}return r.set(e,t),this}function U(e,t){var r=lr(e)||Fe(e)?u(e.length,String):[],n=r.length,o=!!n;for(var i in e)!t&&!Rt.call(e,i)||o&&("length"==i||ge(i,n))||r.push(i);return r}function k(e,t,r){(void 0===r||Ae(e[t],r))&&("number"!=typeof t||void 0!==r||t in e)||(e[t]=r)}function I(e,t,r){var n=e[t];Rt.call(e,t)&&Ae(n,r)&&(void 0!==r||t in e)||(e[t]=r)}function H(e,t){for(var r=e.length;r--;)if(Ae(e[r][0],t))return r;return-1}function Z(e,t){return e&&le(t,ze(t),e)}function K(e,t,r,n,o,a,s){var u;if(n&&(u=a?n(e,o,a,s):n(e)),void 0!==u)return u;if(!Ce(e))return e;var c=lr(e);if(c){if(u=_e(e),!t)return ce(e,u)}else{var f=cr(e),p=f==Xe||f==qe;if(fr(e))return te(e,t);if(f==We||f==Ze||p&&!a){if(l(e))return a?e:{};if(u=me(p?{}:e),!t)return fe(e,Z(u,e))}else{if(!gt[f])return a?e:{};u=xe(e,f,K,t)}}s||(s=new L);var h=s.get(e);if(h)return h;if(s.set(e,u),!c)var d=r?pe(e):ze(e);return i(d||e,function(o,i){d&&(i=o,o=e[i]),I(u,i,K(o,t,r,n,i,e,s))}),u}function G(e){return Ce(e)?Ht(e):{}}function X(e,t,r){var n=t(e);return lr(e)?n:a(n,r(e))}function q(e){return zt.call(e)}function V(e){return!(!Ce(e)||ye(e))&&(Oe(e)||l(e)?Bt:_t).test(Pe(e))}function Q(e){return Le(e)&&Ne(e.length)&&!!xt[zt.call(e)]}function W(e){if(!Te(e))return qt(e);var t=[];for(var r in Object(e))Rt.call(e,r)&&"constructor"!=r&&t.push(r);return t}function $(e){if(!Ce(e))return we(e);var t=Te(e),r=[];for(var n in e)("constructor"!=n||!t&&Rt.call(e,n))&&r.push(n);return r}function Y(e,t,r,n,o){if(e!==t){if(!lr(t)&&!pr(t))var a=$(t);i(a||t,function(i,s){if(a&&(s=i,i=t[s]),Ce(i))o||(o=new L),J(e,t,s,r,Y,n,o);else{var u=n?n(e[s],i,s+"",e,t,o):void 0;void 0===u&&(u=i),k(e,s,u)}})}}function J(e,t,r,n,o,i,a){var s=e[r],u=t[r],c=a.get(u);if(c)return void k(e,r,c);var l=i?i(s,u,r+"",e,t,a):void 0,f=void 0===l;f&&(l=u,lr(u)||pr(u)?lr(s)?l=s:Ee(s)?l=ce(s):(f=!1,l=K(u,!0)):Re(u)||Fe(u)?Fe(s)?l=je(s):!Ce(s)||n&&Oe(s)?(f=!1,l=K(u,!0)):l=s:f=!1),f&&(a.set(u,l),o(l,u,n,i,a),a.delete(u)),k(e,r,l)}function ee(e,t){return t=Vt(void 0===t?e.length-1:t,0),function(){for(var r=arguments,n=-1,i=Vt(r.length-t,0),a=Array(i);++n<i;)a[n]=r[t+n];n=-1;for(var s=Array(t+1);++n<t;)s[n]=r[n];return s[t]=a,o(e,this,s)}}function te(e,t){if(t)return e.slice();var r=new e.constructor(e.length);return e.copy(r),r}function re(e){var t=new e.constructor(e.byteLength);return new kt(t).set(new kt(e)),t}function ne(e,t){var r=t?re(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}function oe(e,t,n){return s(t?n(f(e),!0):f(e),r,new e.constructor)}function ie(e){var t=new e.constructor(e.source,dt.exec(e));return t.lastIndex=e.lastIndex,t}function ae(e,t,r){return s(t?r(h(e),!0):h(e),n,new e.constructor)}function se(e){return sr?Object(sr.call(e)):{}}function ue(e,t){var r=t?re(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}function ce(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}function le(e,t,r,n){r||(r={});for(var o=-1,i=t.length;++o<i;){var a=t[o],s=n?n(r[a],e[a],a,r,e):void 0;I(r,a,void 0===s?e[a]:s)}return r}function fe(e,t){return le(e,ur(e),t)}function pe(e){return X(e,ze,ur)}function he(e,t){var r=e.__data__;return be(t)?r["string"==typeof t?"string":"hash"]:r.map}function de(e,t){var r=c(e,t);return V(r)?r:void 0}function _e(e){var t=e.length,r=e.constructor(t);return t&&"string"==typeof e[0]&&Rt.call(e,"index")&&(r.index=e.index,r.input=e.input),r}function me(e){return"function"!=typeof e.constructor||Te(e)?{}:G(It(e))}function xe(e,t,r,n){var o=e.constructor;switch(t){case rt:return re(e);case Ke:case Ge:return new o(+e);case nt:return ne(e,n);case ot:case it:case at:case st:case ut:case ct:case lt:case ft:case pt:return ue(e,n);case Ve:return oe(e,n,r);case Qe:case Je:return new o(e);case $e:return ie(e);case Ye:return ae(e,n,r);case et:return se(e)}}function ge(e,t){return!!(t=null==t?He:t)&&("number"==typeof e||mt.test(e))&&e>-1&&e%1==0&&e<t}function ve(e,t,r){if(!Ce(r))return!1;var n=typeof t;return!!("number"==n?De(r)&&ge(t,r.length):"string"==n&&t in r)&&Ae(r[t],e)}function be(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function ye(e){return!!Ct&&Ct in e}function Te(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Ot)}function Se(e,t,r,n,o,i){return Ce(e)&&Ce(t)&&(i.set(t,e),Y(e,t,void 0,Se,i),i.delete(t)),e}function we(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}function Pe(e){if(null!=e){try{return Lt.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ae(e,t){return e===t||e!==e&&t!==t}function Fe(e){return Ee(e)&&Rt.call(e,"callee")&&(!Zt.call(e,"callee")||zt.call(e)==Ze)}function De(e){return null!=e&&Ne(e.length)&&!Oe(e)}function Ee(e){return Le(e)&&De(e)}function Oe(e){var t=Ce(e)?zt.call(e):"";return t==Xe||t==qe}function Ne(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=He}function Ce(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Le(e){return!!e&&"object"==typeof e}function Re(e){if(!Le(e)||zt.call(e)!=We||l(e))return!1;var t=It(e);if(null===t)return!0;var r=Rt.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&Lt.call(r)==jt}function je(e){return le(e,Be(e))}function ze(e){return De(e)?U(e):W(e)}function Be(e){return De(e)?U(e,!0):$(e)}function Me(){return[]}function Ue(){return!1}var ke=200,Ie="__lodash_hash_undefined__",He=9007199254740991,Ze="[object Arguments]",Ke="[object Boolean]",Ge="[object Date]",Xe="[object Function]",qe="[object GeneratorFunction]",Ve="[object Map]",Qe="[object Number]",We="[object Object]",$e="[object RegExp]",Ye="[object Set]",Je="[object String]",et="[object Symbol]",tt="[object WeakMap]",rt="[object ArrayBuffer]",nt="[object DataView]",ot="[object Float32Array]",it="[object Float64Array]",at="[object Int8Array]",st="[object Int16Array]",ut="[object Int32Array]",ct="[object Uint8Array]",lt="[object Uint8ClampedArray]",ft="[object Uint16Array]",pt="[object Uint32Array]",ht=/[\\^$.*+?()[\]{}|]/g,dt=/\w*$/,_t=/^\[object .+?Constructor\]$/,mt=/^(?:0|[1-9]\d*)$/,xt={};xt[ot]=xt[it]=xt[at]=xt[st]=xt[ut]=xt[ct]=xt[lt]=xt[ft]=xt[pt]=!0,xt[Ze]=xt["[object Array]"]=xt[rt]=xt[Ke]=xt[nt]=xt[Ge]=xt["[object Error]"]=xt[Xe]=xt[Ve]=xt[Qe]=xt[We]=xt[$e]=xt[Ye]=xt[Je]=xt[tt]=!1;var gt={};gt[Ze]=gt["[object Array]"]=gt[rt]=gt[nt]=gt[Ke]=gt[Ge]=gt[ot]=gt[it]=gt[at]=gt[st]=gt[ut]=gt[Ve]=gt[Qe]=gt[We]=gt[$e]=gt[Ye]=gt[Je]=gt[et]=gt[ct]=gt[lt]=gt[ft]=gt[pt]=!0,gt["[object Error]"]=gt[Xe]=gt[tt]=!1;var vt="object"==typeof w&&w&&w.Object===Object&&w,bt="object"==typeof self&&self&&self.Object===Object&&self,yt=vt||bt||Function("return this")(),Tt=t&&!t.nodeType&&t,St=Tt&&!0&&e&&!e.nodeType&&e,wt=St&&St.exports===Tt,Pt=wt&&vt.process,At=function(){try{return Pt&&Pt.binding("util")}catch(e){}}(),Ft=At&&At.isTypedArray,Dt=Array.prototype,Et=Function.prototype,Ot=Object.prototype,Nt=yt["__core-js_shared__"],Ct=function(){var e=/[^.]+$/.exec(Nt&&Nt.keys&&Nt.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Lt=Et.toString,Rt=Ot.hasOwnProperty,jt=Lt.call(Object),zt=Ot.toString,Bt=RegExp("^"+Lt.call(Rt).replace(ht,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Mt=wt?yt.Buffer:void 0,Ut=yt.Symbol,kt=yt.Uint8Array,It=p(Object.getPrototypeOf,Object),Ht=Object.create,Zt=Ot.propertyIsEnumerable,Kt=Dt.splice,Gt=Object.getOwnPropertySymbols,Xt=Mt?Mt.isBuffer:void 0,qt=p(Object.keys,Object),Vt=Math.max,Qt=de(yt,"DataView"),Wt=de(yt,"Map"),$t=de(yt,"Promise"),Yt=de(yt,"Set"),Jt=de(yt,"WeakMap"),er=de(Object,"create"),tr=Pe(Qt),rr=Pe(Wt),nr=Pe($t),or=Pe(Yt),ir=Pe(Jt),ar=Ut?Ut.prototype:void 0,sr=ar?ar.valueOf:void 0;d.prototype.clear=_,d.prototype.delete=m,d.prototype.get=x,d.prototype.has=g,d.prototype.set=v,b.prototype.clear=y,b.prototype.delete=T,b.prototype.get=S,b.prototype.has=P,b.prototype.set=A,F.prototype.clear=D,F.prototype.delete=E,F.prototype.get=O,F.prototype.has=N,F.prototype.set=C,L.prototype.clear=R,L.prototype.delete=j,L.prototype.get=z,L.prototype.has=B,L.prototype.set=M;var ur=Gt?p(Gt,Object):Me,cr=q;(Qt&&cr(new Qt(new ArrayBuffer(1)))!=nt||Wt&&cr(new Wt)!=Ve||$t&&"[object Promise]"!=cr($t.resolve())||Yt&&cr(new Yt)!=Ye||Jt&&cr(new Jt)!=tt)&&(cr=function(e){var t=zt.call(e),r=t==We?e.constructor:void 0,n=r?Pe(r):void 0;if(n)switch(n){case tr:return nt;case rr:return Ve;case nr:return"[object Promise]";case or:return Ye;case ir:return tt}return t});var lr=Array.isArray,fr=Xt||Ue,pr=Ft?function(e){return function(t){return e(t)}}(Ft):Q,hr=ee(function(e){return e.push(void 0,Se),o(dr,void 0,e)}),dr=function(e){return ee(function(t,r){var n=-1,o=r.length,i=o>1?r[o-1]:void 0,a=o>2?r[2]:void 0;for(i=e.length>3&&"function"==typeof i?(o--,i):void 0,a&&ve(r[0],r[1],a)&&(i=o<3?void 0:i,o=1),t=Object(t);++n<o;){var s=r[n];s&&e(t,s,n,i)}return t})}(function(e,t,r,n){Y(e,t,r,n)});e.exports=hr}),A=l(function(e,t){function r(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function n(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function o(e,t){return null==e?void 0:e[t]}function i(e,t){return"__proto__"==t?void 0:e[t]}function a(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function s(){this.__data__=xt?xt(null):{},this.size=0}function u(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function c(e){var t=this.__data__
;if(xt){var r=t[e];return r===Te?void 0:r}return Ye.call(t,e)?t[e]:void 0}function l(e){var t=this.__data__;return xt?void 0!==t[e]:Ye.call(t,e)}function f(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=xt&&void 0===t?Te:t,this}function p(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function h(){this.__data__=[],this.size=0}function d(e){var t=this.__data__,r=R(t,e);return!(r<0)&&(r==t.length-1?t.pop():lt.call(t,r,1),--this.size,!0)}function _(e){var t=this.__data__,r=R(t,e);return r<0?void 0:t[r][1]}function m(e){return R(this.__data__,e)>-1}function x(e,t){var r=this.__data__,n=R(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}function g(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function v(){this.size=0,this.__data__={hash:new a,map:new(mt||p),string:new a}}function b(e){var t=Q(this,e).delete(e);return this.size-=t?1:0,t}function y(e){return Q(this,e).get(e)}function T(e){return Q(this,e).has(e)}function S(e,t){var r=Q(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}function P(e){var t=this.__data__=new p(e);this.size=t.size}function A(){this.__data__=new p,this.size=0}function F(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function D(e){return this.__data__.get(e)}function E(e){return this.__data__.has(e)}function O(e,t){var r=this.__data__;if(r instanceof p){var n=r.__data__;if(!mt||n.length<ye-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new g(n)}return r.set(e,t),this.size=r.size,this}function N(e,t){var r=St(e),o=!r&&Tt(e),i=!r&&!o&&wt(e),a=!r&&!o&&!i&&Pt(e),s=r||o||i||a,u=s?n(e.length,String):[],c=u.length;for(var l in e)!t&&!Ye.call(e,l)||s&&("length"==l||i&&("offset"==l||"parent"==l)||a&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||J(l,c))||u.push(l);return u}function C(e,t,r){(void 0===r||ue(e[t],r))&&(void 0!==r||t in e)||j(e,t,r)}function L(e,t,r){var n=e[t];Ye.call(e,t)&&ue(n,r)&&(void 0!==r||t in e)||j(e,t,r)}function R(e,t){for(var r=e.length;r--;)if(ue(e[r][0],t))return r;return-1}function j(e,t,r){"__proto__"==t&&pt?pt(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function z(e){return null==e?void 0===e?Le:Oe:ft&&ft in Object(e)?$(e):ie(e)}function B(e){return de(e)&&z(e)==Ae}function M(e){return!(!he(e)||re(e))&&(fe(e)?rt:je).test(se(e))}function U(e){return de(e)&&pe(e.length)&&!!Be[z(e)]}function k(e){if(!he(e))return oe(e);var t=ne(e),r=[];for(var n in e)("constructor"!=n||!t&&Ye.call(e,n))&&r.push(n);return r}function I(e,t,r,n,o){e!==t&&vt(t,function(a,s){if(he(a))o||(o=new P),H(e,t,s,r,I,n,o);else{var u=n?n(i(e,s),a,s+"",e,t,o):void 0;void 0===u&&(u=a),C(e,s,u)}},xe)}function H(e,t,r,n,o,a,s){var u=i(e,r),c=i(t,r),l=s.get(c);if(l)return void C(e,r,l);var f=a?a(u,c,r+"",e,t,s):void 0,p=void 0===f;if(p){var h=St(c),d=!h&&wt(c),_=!h&&!d&&Pt(c);f=c,h||d||_?St(u)?f=u:le(u)?f=q(u):d?(p=!1,f=K(c,!0)):_?(p=!1,f=X(c,!0)):f=[]:_e(c)||Tt(c)?(f=u,Tt(u)?f=me(u):(!he(u)||n&&fe(u))&&(f=Y(c))):p=!1}p&&(s.set(c,f),o(f,c,n,a,s),s.delete(c)),C(e,r,f)}function Z(e,t){return yt(ae(e,t,ve),e+"")}function K(e,t){if(t)return e.slice();var r=e.length,n=at?at(r):new e.constructor(r);return e.copy(n),n}function G(e){var t=new e.constructor(e.byteLength);return new it(t).set(new it(e)),t}function X(e,t){var r=t?G(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}function q(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}function V(e,t,r,n){var o=!r;r||(r={});for(var i=-1,a=t.length;++i<a;){var s=t[i],u=n?n(r[s],e[s],s,r,e):void 0;void 0===u&&(u=e[s]),o?j(r,s,u):L(r,s,u)}return r}function Q(e,t){var r=e.__data__;return te(t)?r["string"==typeof t?"string":"hash"]:r.map}function W(e,t){var r=o(e,t);return M(r)?r:void 0}function $(e){var t=Ye.call(e,ft),r=e[ft];try{e[ft]=void 0;var n=!0}catch(e){}var o=et.call(e);return n&&(t?e[ft]=r:delete e[ft]),o}function Y(e){return"function"!=typeof e.constructor||ne(e)?{}:gt(st(e))}function J(e,t){var r=typeof e;return!!(t=null==t?Pe:t)&&("number"==r||"symbol"!=r&&ze.test(e))&&e>-1&&e%1==0&&e<t}function ee(e,t,r){if(!he(r))return!1;var n=typeof t;return!!("number"==n?ce(r)&&J(t,r.length):"string"==n&&t in r)&&ue(r[t],e)}function te(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function re(e){return!!Je&&Je in e}function ne(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Qe)}function oe(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}function ie(e){return et.call(e)}function ae(e,t,n){return t=dt(void 0===t?e.length-1:t,0),function(){for(var o=arguments,i=-1,a=dt(o.length-t,0),s=Array(a);++i<a;)s[i]=o[t+i];i=-1;for(var u=Array(t+1);++i<t;)u[i]=o[i];return u[t]=n(s),r(e,this,u)}}function se(e){if(null!=e){try{return $e.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function ue(e,t){return e===t||e!==e&&t!==t}function ce(e){return null!=e&&pe(e.length)&&!fe(e)}function le(e){return de(e)&&ce(e)}function fe(e){if(!he(e))return!1;var t=z(e);return t==De||t==Ee||t==Fe||t==Ce}function pe(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=Pe}function he(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function de(e){return null!=e&&"object"==typeof e}function _e(e){if(!de(e)||z(e)!=Ne)return!1;var t=st(e);if(null===t)return!0;var r=Ye.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&$e.call(r)==tt}function me(e){return V(e,xe(e))}function xe(e){return ce(e)?N(e,!0):k(e)}function ge(e){return function(){return e}}function ve(e){return e}function be(){return!1}var ye=200,Te="__lodash_hash_undefined__",Se=800,we=16,Pe=9007199254740991,Ae="[object Arguments]",Fe="[object AsyncFunction]",De="[object Function]",Ee="[object GeneratorFunction]",Oe="[object Null]",Ne="[object Object]",Ce="[object Proxy]",Le="[object Undefined]",Re=/[\\^$.*+?()[\]{}|]/g,je=/^\[object .+?Constructor\]$/,ze=/^(?:0|[1-9]\d*)$/,Be={};Be["[object Float32Array]"]=Be["[object Float64Array]"]=Be["[object Int8Array]"]=Be["[object Int16Array]"]=Be["[object Int32Array]"]=Be["[object Uint8Array]"]=Be["[object Uint8ClampedArray]"]=Be["[object Uint16Array]"]=Be["[object Uint32Array]"]=!0,Be[Ae]=Be["[object Array]"]=Be["[object ArrayBuffer]"]=Be["[object Boolean]"]=Be["[object DataView]"]=Be["[object Date]"]=Be["[object Error]"]=Be[De]=Be["[object Map]"]=Be["[object Number]"]=Be[Ne]=Be["[object RegExp]"]=Be["[object Set]"]=Be["[object String]"]=Be["[object WeakMap]"]=!1;var Me="object"==typeof w&&w&&w.Object===Object&&w,Ue="object"==typeof self&&self&&self.Object===Object&&self,ke=Me||Ue||Function("return this")(),Ie=t&&!t.nodeType&&t,He=Ie&&!0&&e&&!e.nodeType&&e,Ze=He&&He.exports===Ie,Ke=Ze&&Me.process,Ge=function(){try{return Ke&&Ke.binding&&Ke.binding("util")}catch(e){}}(),Xe=Ge&&Ge.isTypedArray,qe=Array.prototype,Ve=Function.prototype,Qe=Object.prototype,We=ke["__core-js_shared__"],$e=Ve.toString,Ye=Qe.hasOwnProperty,Je=function(){var e=/[^.]+$/.exec(We&&We.keys&&We.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),et=Qe.toString,tt=$e.call(Object),rt=RegExp("^"+$e.call(Ye).replace(Re,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),nt=Ze?ke.Buffer:void 0,ot=ke.Symbol,it=ke.Uint8Array,at=nt?nt.allocUnsafe:void 0,st=function(e,t){return function(r){return e(t(r))}}(Object.getPrototypeOf,Object),ut=Object.create,ct=Qe.propertyIsEnumerable,lt=qe.splice,ft=ot?ot.toStringTag:void 0,pt=function(){try{var e=W(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),ht=nt?nt.isBuffer:void 0,dt=Math.max,_t=Date.now,mt=W(ke,"Map"),xt=W(Object,"create"),gt=function(){function e(){}return function(t){if(!he(t))return{};if(ut)return ut(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();a.prototype.clear=s,a.prototype.delete=u,a.prototype.get=c,a.prototype.has=l,a.prototype.set=f,p.prototype.clear=h,p.prototype.delete=d,p.prototype.get=_,p.prototype.has=m,p.prototype.set=x,g.prototype.clear=v,g.prototype.delete=b,g.prototype.get=y,g.prototype.has=T,g.prototype.set=S,P.prototype.clear=A,P.prototype.delete=F,P.prototype.get=D,P.prototype.has=E,P.prototype.set=O;var vt=function(e){return function(t,r,n){for(var o=-1,i=Object(t),a=n(t),s=a.length;s--;){var u=a[e?s:++o];if(!1===r(i[u],u,i))break}return t}}(),bt=pt?function(e,t){return pt(e,"toString",{configurable:!0,enumerable:!1,value:ge(t),writable:!0})}:ve,yt=function(e){var t=0,r=0;return function(){var n=_t(),o=we-(n-r);if(r=n,o>0){if(++t>=Se)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(bt),Tt=B(function(){return arguments}())?B:function(e){return de(e)&&Ye.call(e,"callee")&&!ct.call(e,"callee")},St=Array.isArray,wt=ht||be,Pt=Xe?function(e){return function(t){return e(t)}}(Xe):U,At=function(e){return Z(function(t,r){var n=-1,o=r.length,i=o>1?r[o-1]:void 0,a=o>2?r[2]:void 0;for(i=e.length>3&&"function"==typeof i?(o--,i):void 0,a&&ee(r[0],r[1],a)&&(i=o<3?void 0:i,o=1),t=Object(t);++n<o;){var s=r[n];s&&e(t,s,n,i)}return t})}(function(e,t,r){I(e,t,r)});e.exports=At});f.prototype.render=function(e){this._needsRefresh=!0},f.prototype.setPostEffect=function(e){A(this._graphicOpts.postEffect,e),this._renderMain.setPostEffect(this._graphicOpts.postEffect)},f.prototype._loop=function(e){this._disposed||this._needsRefresh&&(this._needsRefresh=!1,this._renderMain.prepareRender(),this._renderMain.render(),this._startAccumulating())};var F=1;return f.prototype._stopAccumulating=function(){this._accumulatingId=0,clearTimeout(this._accumulatingTimeout)},f.prototype._startAccumulating=function(e){function t(o){if(r._accumulatingId&&o===r._accumulatingId&&!r._disposed){r._renderMain.isAccumulateFinished()&&n||(r._renderMain.render(!0),e?t(o):requestAnimationFrame(function(){t(o)}))}}var r=this;this._stopAccumulating();var n=r._renderMain.needsAccumulate();n&&(this._accumulatingId=F++,e?t(r._accumulatingId):this._accumulatingTimeout=setTimeout(function(){t(r._accumulatingId)},50))},f.prototype.dispose=function(){this._disposed=!0,this._renderMain.dispose()},f.version="0.1.0",f});
